// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client"
  output   = "../src/app/generated/prisma"
}

datasource db {
  provider = "mysql"
}

model Sector {
id Int @id @default(autoincrement())
name String @unique
hsCode String?


subSectors SubSector[]
companies Company[]
companySectors CompanySector[]
eventSectors   EventSector[]


createdAt DateTime @default(now())
}


model SubSector {
id Int @id @default(autoincrement())
name String
hsCode String?


sectorId Int
sector Sector @relation(fields: [sectorId], references: [id])


products Product[]
companies Company[]
companySubSectors CompanySubSector[]


createdAt DateTime @default(now())
}


model Product {
id Int @id @default(autoincrement())
name String
hsCode String?


subSectorId Int
subSector SubSector @relation(fields: [subSectorId], references: [id])


createdAt DateTime @default(now())
}

model Company {
id Int @id @default(autoincrement())
name String
profile String? @db.Text
address String?
email String?
website String?
representativeName String?
representativeTel String?
representativeWhatsapp String?
representativeEmail String?
productsToBeDisplayed String?

// Primary / legacy single-FK (kept for backward-compat with existing data & filters)
sectorId Int?
sector   Sector?   @relation(fields: [sectorId], references: [id])

subSectorId Int?
subSector   SubSector? @relation(fields: [subSectorId], references: [id])

// Many-to-many: all selected sectors / sub-sectors
sectors    CompanySector[]
subSectors CompanySubSector[]

eventParticipations EventCompany[]
delegationParticipations DelegationCompany[]
feedbacks EventFeedback[]

createdAt DateTime @default(now())
}

// ── Junction: Company ↔ Sector (many-to-many) ──────────────────────────────
model CompanySector {
  id        Int     @id @default(autoincrement())
  companyId Int
  sectorId  Int

  company Company @relation(fields: [companyId], references: [id], onDelete: Cascade)
  sector  Sector  @relation(fields: [sectorId],  references: [id], onDelete: Cascade)

  @@unique([companyId, sectorId])
}

// ── Junction: Company ↔ SubSector (many-to-many) ───────────────────────────
model CompanySubSector {
  id          Int @id @default(autoincrement())
  companyId   Int
  subSectorId Int

  company   Company   @relation(fields: [companyId],   references: [id], onDelete: Cascade)
  subSector SubSector @relation(fields: [subSectorId], references: [id], onDelete: Cascade)

  @@unique([companyId, subSectorId])
}

model Event {
  id          Int      @id @default(autoincrement())
  name        String
  description String?
  location    String?
  eventDate   DateTime
  deskOfficer String?

  // Excel sheet fields (Events / Exhibitions planning)
  division String?
  region   String?
  country  String?
  city     String?
  sectorProducts String?

  // Date range (if provided)
  startDate DateTime?
  endDate   DateTime?
  datesText String?

  // Budget fields (Rs.)
  subsidyPercentage   Decimal? @db.Decimal(5, 2)
  tdapCost            Decimal? @db.Decimal(15, 2)
  exhibitorCost       Decimal? @db.Decimal(15, 2)
  totalEstimatedBudget Decimal? @db.Decimal(15, 2)

  recommendedByJustification String?

  // Feedback workflow
  feedbackFormUrl String?
  finalRemarks    String?

  // Relations
  participants EventCompany[]
  feedbacks    EventFeedback[]
  eventSectors EventSector[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

// ── Junction: Event ↔ Sector (many-to-many) ────────────────────────────────
model EventSector {
  id       Int @id @default(autoincrement())
  eventId  Int
  sectorId Int

  event  Event  @relation(fields: [eventId],  references: [id], onDelete: Cascade)
  sector Sector @relation(fields: [sectorId], references: [id], onDelete: Cascade)

  @@unique([eventId, sectorId])
}

model EventCompany {
  id Int @id @default(autoincrement())

  eventId   Int
  companyId Int

  event   Event   @relation(fields: [eventId], references: [id], onDelete: Cascade)
  company Company @relation(fields: [companyId], references: [id], onDelete: Cascade)

  createdAt DateTime @default(now())

  @@unique([eventId, companyId])
}

model EventFeedback {
  id Int @id @default(autoincrement())

  eventId Int
  event   Event @relation(fields: [eventId], references: [id], onDelete: Cascade)

  // Link to the participating company
  companyId Int?
  company   Company? @relation(fields: [companyId], references: [id], onDelete: SetNull)

  sourceType FeedbackSource

  // Section 1–5: Company Info
  companyName    String?
  companyAddress String?
  contactPerson  String?  // Name & Designation
  contactNumber  String?
  sourceEmail    String?

  // Section 6: Products
  productsExhibited String?

  // Section 8–13: Business Results
  b2bMeetings       Int?
  existingCustomers Int?
  newContacts       Int?
  visitorsCountries String?
  ordersBooked      Decimal? @db.Decimal(15, 2) // USD
  expectedOrders    Decimal? @db.Decimal(15, 2) // USD

  // Section 14–15: Unmaterialized Inquiries
  hadUnmaterializedInquiries Boolean?
  unmaterializedReasons      String?  // JSON array of strings

  // Section 16–17: Competition
  majorCompetitors           String?
  competitorMarketingMethods String?  // JSON array of strings

  // Section 18–23: Closing Questions
  problemsFaced              String?
  improvementSuggestions     String?
  tdapRecommendations        String?
  continueFairParticipation  Boolean?
  satisfactionLevel          String?  // "Very satisfied" | "Satisfied" | "Neutral" | "Dissatisfied"
  additionalComments         String?

  // Legacy / kept for backward compat
  sourceName String?
  rating     Int?
  comments   String?

  submittedAt DateTime @default(now())
}

enum FeedbackSource {
  COMPANY
  MISSION
}

model Mission {
  id     Int @id @default(autoincrement())
  name   String
  region String
  email  String
}

enum DelegationType {
  INCOMING
  OUTGOING
}

enum DelegationStatus {
  ACTIVE
  CLOSED
}

model Delegation {
  id          Int      @id @default(autoincrement())
  type        DelegationType
  status      DelegationStatus @default(ACTIVE)
  
  // Common fields
  division    String?
  productSector String?
  expectedDelegates String? // e.g., "2-4 delegates", "10"
  rationale   String? // Rationale/Objectives/Justification
  
  // Incoming delegation fields
  fromCountry String?
  
  // Outgoing delegation fields
  toCountry   String?
  startDate   DateTime? // Delegation start date
  endDate     DateTime? // Delegation end date
  
  // Budget management
  allocatedBudget Decimal? @db.Decimal(15, 2) // Tentative Expenditure / Proposed Budget
  utilizedBudget  Decimal? @db.Decimal(15, 2) // Added when closing delegation
  
  // Closing information
  closedAt    DateTime?
  closingRemarks String?
  
  // Relations
  participants DelegationCompany[]
  
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model DelegationCompany {
  id Int @id @default(autoincrement())
  
  delegationId Int
  companyId    Int
  
  delegation Delegation @relation(fields: [delegationId], references: [id], onDelete: Cascade)
  company     Company   @relation(fields: [companyId], references: [id], onDelete: Cascade)
  
  createdAt DateTime @default(now())
  
  @@unique([delegationId, companyId])
}

enum SeminarStatus {
  PLANNED
  COMPLETED
  CANCELLED
}

enum SeminarType {
  SEMINAR
  WEBINAR
  VIRTUAL_B2B
}

model Seminar {
  id                    Int           @id @default(autoincrement())
  
  // Core planning fields (from Excel sheet)
  type                  SeminarType   @default(SEMINAR)
  productSector         String?       // Product / Sector column
  title                 String        // Event Details column
  cityVenue             String?       // City / Venue column
  tentativeDate         String?       // Tentative Date (e.g. "Aug-25", "Mar-26")
  proposedBudget        Decimal?      @db.Decimal(15, 2) // Proposed Budget (PKR)
  division              String?       // Division column
  regionalCollaboration String?       // Regional Collaboration column
  rationaleObjective    String?       @db.Text // Rationale/Objective column
  
  status                SeminarStatus @default(PLANNED)
  
  // Additional admin fields
  deskOfficer           String?
  finalRemarks          String?
  
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}