// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client"
  output   = "../src/app/generated/prisma"
}

datasource db {
  provider = "mysql"
}

model Sector {
id Int @id @default(autoincrement())
name String @unique
hsCode String?


subSectors SubSector[]
companies Company[]


createdAt DateTime @default(now())
}


model SubSector {
id Int @id @default(autoincrement())
name String
hsCode String?


sectorId Int
sector Sector @relation(fields: [sectorId], references: [id])


products Product[]
companies Company[]


createdAt DateTime @default(now())
}


model Product {
id Int @id @default(autoincrement())
name String
hsCode String?


subSectorId Int
subSector SubSector @relation(fields: [subSectorId], references: [id])


createdAt DateTime @default(now())
}

model Company {
id Int @id @default(autoincrement())
name String
profile String?
address String?
email String?
website String?
representativeName String?
representativeTel String?
representativeWhatsapp String?
representativeEmail String?
productsToBeDisplayed String?

sectorId Int?
sector   Sector?   @relation(fields: [sectorId], references: [id])

subSectorId Int?
subSector   SubSector? @relation(fields: [subSectorId], references: [id])

eventParticipations EventCompany[]
delegationParticipations DelegationCompany[]

createdAt DateTime @default(now())
}

model Event {
  id          Int      @id @default(autoincrement())
  name        String
  description String?
  location    String?
  eventDate   DateTime

  // Excel sheet fields (Events / Exhibitions planning)
  division String?
  region   String?
  country  String?
  city     String?
  sectorProducts String?

  // Date range (if provided)
  startDate DateTime?
  endDate   DateTime?
  datesText String?

  // Budget fields (Rs.)
  subsidyPercentage   Decimal? @db.Decimal(5, 2)
  tdapCost            Decimal? @db.Decimal(15, 2)
  exhibitorCost       Decimal? @db.Decimal(15, 2)
  totalEstimatedBudget Decimal? @db.Decimal(15, 2)

  recommendedByJustification String?

  // Feedback workflow
  feedbackFormUrl String?
  finalRemarks    String?

  // Relations
  participants EventCompany[]
  feedbacks    EventFeedback[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model EventCompany {
  id Int @id @default(autoincrement())

  eventId   Int
  companyId Int

  event   Event   @relation(fields: [eventId], references: [id], onDelete: Cascade)
  company Company @relation(fields: [companyId], references: [id], onDelete: Cascade)

  createdAt DateTime @default(now())

  @@unique([eventId, companyId])
}

model EventFeedback {
  id Int @id @default(autoincrement())

  eventId Int
  event   Event @relation(fields: [eventId], references: [id], onDelete: Cascade)

  // Who gave feedback
  sourceType  FeedbackSource
  sourceName  String?
  sourceEmail String?

  rating   Int?
  comments String?

  submittedAt DateTime @default(now())
}

enum FeedbackSource {
  COMPANY
  MISSION
}

model Mission {
  id     Int @id @default(autoincrement())
  name   String
  region String
  email  String
}

enum DelegationType {
  INCOMING
  OUTGOING
}

enum DelegationStatus {
  ACTIVE
  CLOSED
}

model Delegation {
  id          Int      @id @default(autoincrement())
  type        DelegationType
  status      DelegationStatus @default(ACTIVE)
  
  // Common fields
  division    String?
  productSector String?
  expectedDelegates String? // e.g., "2-4 delegates", "10"
  rationale   String? // Rationale/Objectives/Justification
  
  // Incoming delegation fields
  fromCountry String?
  
  // Outgoing delegation fields
  toCountry   String?
  dates       String? // e.g., "to be decided in consultation with the mission"
  
  // Budget management
  allocatedBudget Decimal? @db.Decimal(15, 2) // Tentative Expenditure / Proposed Budget
  utilizedBudget  Decimal? @db.Decimal(15, 2) // Added when closing delegation
  
  // Closing information
  closedAt    DateTime?
  closingRemarks String?
  
  // Relations
  participants DelegationCompany[]
  
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model DelegationCompany {
  id Int @id @default(autoincrement())
  
  delegationId Int
  companyId    Int
  
  delegation Delegation @relation(fields: [delegationId], references: [id], onDelete: Cascade)
  company     Company   @relation(fields: [companyId], references: [id], onDelete: Cascade)
  
  createdAt DateTime @default(now())
  
  @@unique([delegationId, companyId])
}
